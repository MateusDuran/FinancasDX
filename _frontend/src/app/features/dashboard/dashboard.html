<div class="min-h-screen bg-gray-50">
  <div class="max-w-4xl mx-auto px-4 py-8">
    
    <!-- Header -->
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Ola, {{ usuario?.nome || 'Usuario' }}</h1>
        <p class="text-gray-600 text-sm">Seu resumo financeiro</p>
      </div>
      <div class="flex gap-3">
        <button (click)="onShowUser()" class="px-4 py-2 text-sm border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
          Meus Dados
        </button>
        <button (click)="onShowNewTransaction()" class="px-4 py-2 text-sm bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
          + Nova Transacao
        </button>
        <button (click)="logout()" class="px-4 py-2 text-sm border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors">
          Sair
        </button>
      </div>
    </header>

    <!-- Card Saldo -->
    <section class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
      <p class="text-sm text-gray-600 mb-1">Saldo Atual</p>
      <p class="text-3xl font-bold" [ngClass]="saldo >= 0 ? 'text-success' : 'text-danger'">
        R$ {{ saldo | number:'1.2-2' }}
      </p>
    </section>

    <!-- Transacoes Recentes -->
    <section class="bg-white rounded-lg border border-gray-200 p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">Transacoes Recentes</h2>
        <div class="flex gap-2">
          <select class="text-sm border border-gray-300 rounded-lg px-3 py-1.5" [(ngModel)]="filterTipo" (change)="onFiltroChange()">
            <option value="TODOS">Todos</option>
            <option value="ENTRADA">Entradas</option>
            <option value="SAIDA">Saidas</option>
          </select>
        </div>
      </div>

      <div *ngIf="lancamentos.length; else semLancamentos">
        <ul class="divide-y divide-gray-100">
          <li *ngFor="let l of lancamentos" class="py-3 flex justify-between items-center">
            <div>
              <p class="font-medium text-gray-900">{{ l.descricao || (l.tipo === 'ENTRADA' ? 'Entrada' : 'Saida') }}</p>
              <p class="text-xs text-gray-500" *ngIf="l.dataObj">{{ l.dataObj | date:'dd/MM/yyyy HH:mm' }}</p>
            </div>
            <p class="font-semibold" [ngClass]="l.tipo === 'ENTRADA' ? 'text-success' : 'text-danger'">
              {{ l.tipo === 'ENTRADA' ? '+' : '-' }}R$ {{ l.valor | number:'1.2-2' }}
            </p>
          </li>
        </ul>
      </div>
      <ng-template #semLancamentos>
        <p class="text-center text-gray-500 py-8">Nenhuma transacao encontrada</p>
      </ng-template>
    </section>

  </div>

  <!-- Modal Perfil -->
  <div *ngIf="showUser" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-sm">
      <h2 class="text-lg font-bold text-gray-900 mb-4">Meus Dados</h2>
      
      <div *ngIf="usuarioLoading" class="text-center py-4">
        <p class="text-gray-600">Carregando...</p>
      </div>

      <form *ngIf="!usuarioLoading && editUsuario" (ngSubmit)="onSaveEdit()">
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
            <input class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" [(ngModel)]="editUsuario.nome" name="nome" [disabled]="!editMode">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" [(ngModel)]="editUsuario.email" name="email" type="email" [disabled]="!editMode">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
            <input class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" [(ngModel)]="editUsuario.cpf" name="cpf" [disabled]="!editMode">
          </div>
          <div *ngIf="editMode">
            <label class="block text-sm font-medium text-gray-700 mb-1">Senha (obrigatoria para salvar)</label>
            <input class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" [(ngModel)]="editUsuario.senha" name="senha" type="password">
          </div>
        </div>

        <div class="flex gap-2 mt-4">
          <button type="button" *ngIf="!editMode" (click)="onEditUser()" class="flex-1 px-4 py-2 text-sm bg-primary text-white rounded-lg">Editar</button>
          <button type="submit" *ngIf="editMode" class="flex-1 px-4 py-2 text-sm bg-success text-white rounded-lg">Salvar</button>
          <button type="button" (click)="onCloseUser()" class="flex-1 px-4 py-2 text-sm border border-gray-300 rounded-lg text-gray-700">Fechar</button>
        </div>
      </form>

      <div *ngIf="!usuarioLoading && !editUsuario" class="text-center py-4">
        <p class="text-danger mb-2">Erro ao carregar dados</p>
        <button (click)="loadUser()" class="text-sm text-primary">Tentar novamente</button>
      </div>
    </div>
  </div>

  <!-- Modal Nova Transacao -->
  <div *ngIf="showNewTransacaoModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg p-6 w-full max-w-sm">
      <h2 class="text-lg font-bold text-gray-900 mb-4">Nova Transacao</h2>
      
      <form (ngSubmit)="onSubmitNewTransaction()">
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
            <select class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" [(ngModel)]="newTransacao.tipo" name="tipo">
              <option value="ENTRADA">Entrada</option>
              <option value="SAIDA">Saida</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
            <input class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" type="number" min="0" step="0.01" [(ngModel)]="newTransacao.valor" name="valor" placeholder="0,00">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Data e hora (opcional)</label>
            <input class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" type="datetime-local" [(ngModel)]="newTransacaoDataLocal" name="data">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Descricao (opcional)</label>
            <input class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg" type="text" [(ngModel)]="newTransacao.descricao" name="descricao" placeholder="Ex: Almoco, Salario...">
          </div>
        </div>

        <div class="flex gap-2 mt-4">
          <button type="submit" [disabled]="savingNewTransacao" class="flex-1 px-4 py-2 text-sm bg-success text-white rounded-lg disabled:opacity-50">
            {{ savingNewTransacao ? 'Salvando...' : 'Salvar' }}
          </button>
          <button type="button" (click)="onCancelNewTransaction()" class="flex-1 px-4 py-2 text-sm border border-gray-300 rounded-lg text-gray-700">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

</div>
